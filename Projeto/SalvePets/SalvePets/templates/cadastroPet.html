{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}

{% block conteudo %}
<script>

function updateTextInput()
{
        var value = document.getElementById("range").value;

        var img = document.getElementById('imageRange');

        img.height = value

}

function SetSize(porte){

var tamanho;

    switch (porte){
        case 'pequeno':
            tamanho = 40
        break;
        case 'medio':
            tamanho = 80
        break;
        case 'grande':
            tamanho = 120
        break;
    }

    document.getElementById("range").value = tamanho;
    updateTextInput();

}

</script>

    <!-- Página de Login-->
<div class="container mt-4">
    <ul class="nav nav-tabs nav-fill">
        <li class="nav-item">
            <a class="nav-link" style="color:#495057" href="/lista-pet-usuario/">{% trans "Meus pets" %}</a>
        </li>
        <li class="nav-item">
            {% if pet.id %}
                <a class="nav-link" style="color:#495057" href="/cadastro-pet/">{% trans "Cadastrar pet" %}</a>
            {% else %}
                <a class="nav-link active"><b>{% trans "Cadastrar pet" %}</b></a>
            {% endif %}
        </li>
        <li class="nav-item">
            <a class="nav-link" style="color:#495057" href="/lista-pet-perdido/">{% trans "Pets perdidos" %}</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" style="color:#495057" href="/lista-pet-encontrado/">{% trans "Pets encontrados" %}</a>
        </li>
    </ul>
</div>


    <form enctype="multipart/form-data" action="submit", method="POST">{% csrf_token %}
        <input type="number" class="form-control" name="pet-id" value="{{ pet.id }}" hidden>
        <div class="container">
        <p><h3>{% trans "Cadastrar um pet" %}</h3></p>
            <div class="form-group">
                {% if pet.id != null %}
                    <label><b>{% trans "Alterar imagem" %}:</b></label>
                    <p><a href="/media/{{ pet.foto }}" target="_blank"><img src="/media/{{ pet.foto }}" style="width:100%; max-width:300px;"></a></p>
                {% else %}
                    <label><b>{% trans "Foto" %}</b>:</label><br>
                {% endif %}
                {% if pet.id != null %}
                    <input type="file" class="form-control-file border" name="foto" accept="image/*" value="{{ pet.foto }}">
                {% else %}
                    <input required="required" type="file" class="form-control-file border" name="foto" accept="image/*" value="{{ pet.foto }}" >
                {% endif %}
            </div>
            <br>
            <div class="form-group">
                <label><b>{% trans "Nome" %}</b>:</label>
                <input class="form-control" name="nome" type="text" value="{{ pet.nome|default_if_none:"Sem nome" }}" placeholder="Caso não saiba, mantenha este campo vazio">
            </div>
            <br>
            <div class="form-group">
                <label><b>{% trans "Detalhes" %}</b>:</label>
                <textarea class="form-control" rows="3" name="descricao" type="text" placeholder="Tente inserir o máximo de detalhes sobre o pet">{{ pet.descricao|default_if_none:"" }}</textarea>
            </div>
            <br>
            <div class="form-group">
                <label><b>{% trans "Data de localização ou perda" %}</b>:</label>
                <input class="form-control" name="dataPerdaEncontro" type="date" value="{{ pet.dataPerdaEncontro | date:'Y-m-d' }}">
            </div>
            <br>


            <div class="form-group">
                <label><b>{% trans "Espécie" %}</b>:</label>
                <select class="form-control mb-4" name="especie" value="{{ pet.especie }}">
                    <option value="Cachorro"
                        {% if pet.especie == "Cachorro" %} selected="selected" {% endif %}
                    >{% trans "Cachorro" %}</option>
                    <option value="Gato"
                        {% if pet.especie == "Gato" %} selected="selected" {% endif %}
                    >{% trans "Gato" %}</option>
                    <option value="Outros"
                        {% if pet.especie == "Outros" %} selected="selected" {% endif %}
                    >{% trans "Outros" %}</option>
                  </select>
            </div>

            <div class="form-group">
                <label><b>{% trans "Raça" %}</b>:</label>
                <input class="form-control" name="raca" type="text" value="{{ pet.raca|default_if_none:"" }}">
            </div>
            <br>
            <div class="form-group">
                <label><b>{% trans "Sexo" %}</b>:</label>
                <select class="form-control mb-4" name="sexo" value="{{ pet.sexo }}">
                    <option value="Macho"
                        {% if pet.sexo == "Macho" %} selected="selected" {% endif %}
                    >{% trans "Macho" %}</option>
                    <option value="Fêmea"
                        {% if pet.sexo == "Fêmea" %} selected="selected" {% endif %}
                    >{% trans "Fêmea" %}</option>
                    <option value="Não sei"
                        {% if pet.sexo == "Não sei" %} selected="selected" {% endif %}
                    >{% trans "Não sei" %}</option>
                </select>
            </div>
            
            <div class="form-group">
                <label><b>{% trans "Cor predominante" %}</b>:</label>
                <input class="form-control" name="cor" type="text"  value="{{ pet.cor|default_if_none:"" }}">
            </div>
            <br>
            <div class="form-group">
                <label><b>{% trans "Porte" %}</b>:</label><br>
                <button class="btn btn-primary" style="color:black; font-size:70%" onclick="SetSize('pequeno')" type="button">Pequeno porte</button>
                <button class="btn btn-primary" style="color:black; font-size:70%" onclick="SetSize('medio')" type="button">Médio porte</button>
                <button class="btn btn-primary" style="color:black; font-size:70%" onclick="SetSize('grande')" type="button">Grande porte</button><br><br>
                
                <table class="fixed">
                    <tr>
                        <td><img src="{% static 'core/assets/img/human.png' %}" height="150" /></td>
                        <td style="vertical-align:bottom; padding-left: 15px"><img id="imageRange" src="{% static 'core/assets/img/dog.png' %}" height="
                        {% if pet.porte %}
	                        {{pet.porte}}
                        {% else %}
                            80
                        {% endif %}
                        " /></td>
                    </tr>
                </table>
                <input class="form-range" style="width:250px" id="range" type="range" min="40" step="0" max="120" oninput="updateTextInput();" name="porte" value="{{ pet.porte|default_if_none:120 }}" > 

            <div class="form-group">
                <label><b>{% trans "Situação do pet" %}</b>:</label>
                <select class="form-control mb-4" name="encontradoPerdido" value="{{ pet.encontradoPerdido }}">
                    <option value="Encontrado"
                        {% if pet.encontradoPerdido == "Encontrado" %} selected="selected" {% endif %}
                    >{% trans "Encontrado" %}</option>
                    <option value="Perdido"
                        {% if pet.encontradoPerdido == "Perdido" %} selected="selected" {% endif %}
                    >{% trans "Perdido" %}</option>
                </select>
            </div>

        













<!--novaas alterações -->

            <div class="form-group">
                <fieldset class="module aligned ">
                    <div class="form-row field-user">

                    <div class="form-row field-coordenada">

                        <div>
                            <p></p>
                            <p></p>
                            <label class="required" for="id_coordenada"><b>{% trans "Indique a localização" %}</b>: *</label>
                            
                            
                            





                            <style>
                                #id_coordenada-map {
                                    width: min(calc(100vw - 30px), 720px);
                                    height: 400px;
                                }

                                #id_coordenada {
                                    display: none;
                                }


                                /* Fixes for Django base.css */
                                .module .leaflet-draw ul {
                                    margin-left: 0px;
                                    padding-left: 0px;
                                }

                                .module .leaflet-draw ul li {
                                    list-style-type: none;
                                }
                            </style>

                            <script>

                                var geodjango_id_coordenada = {};
                                geodjango_id_coordenada.fieldid = 'id_coordenada';
                                geodjango_id_coordenada.modifiable = true;
                                geodjango_id_coordenada.geom_type = 'Point';
                                geodjango_id_coordenada.srid = 4326;



                                L.drawLocal.draw.toolbar.actions.title = "Cancel drawing";
                                L.drawLocal.draw.toolbar.actions.text = "Cancel";
                                L.drawLocal.draw.toolbar.undo.title = "Delete last point drawn";
                                L.drawLocal.draw.toolbar.undo.text = "Delete last point";
                                L.drawLocal.draw.toolbar.buttons.polyline = "Draw a polyline";
                                L.drawLocal.draw.toolbar.buttons.polygon = "Draw a polygon";
                                L.drawLocal.draw.toolbar.buttons.rectangle = "Draw a rectangle";
                                L.drawLocal.draw.toolbar.buttons.circle = "Draw a circle";
                                L.drawLocal.draw.toolbar.buttons.marker = "Draw a marker";
                                L.drawLocal.draw.handlers.circle.tooltip.start = "Click and drag to draw circle.";
                                L.drawLocal.draw.handlers.marker.tooltip.start = "Click map to place marker.";
                                L.drawLocal.draw.handlers.polygon.tooltip.start = "Click to start drawing shape.";
                                L.drawLocal.draw.handlers.polygon.tooltip.cont = "Click to continue drawing shape.";
                                L.drawLocal.draw.handlers.polygon.tooltip.end = "Click first point to close this shape.";
                                L.drawLocal.draw.handlers.polyline.error = "<strong>Error:</strong> shape edges cannot cross!";
                                L.drawLocal.draw.handlers.polyline.tooltip.start = "Click to start drawing line.";
                                L.drawLocal.draw.handlers.polyline.tooltip.cont = "Click to continue drawing line.";
                                L.drawLocal.draw.handlers.polyline.tooltip.end = "Click last point to finish line.";
                                L.drawLocal.draw.handlers.rectangle.tooltip.start = "Click and drag to draw rectangle.";
                                L.drawLocal.draw.handlers.simpleshape.tooltip.end = "Release mouse to finish drawing.";

                                L.drawLocal.edit.toolbar.actions.save.title = "Save changes.";
                                L.drawLocal.edit.toolbar.actions.save.text = "Salvar";
                                L.drawLocal.edit.toolbar.actions.cancel.title = "Cancel editing, discards all changes.";
                                L.drawLocal.edit.toolbar.actions.cancel.text = "Cancel";
                                L.drawLocal.edit.toolbar.buttons.edit = "Edit layers";
                                L.drawLocal.edit.toolbar.buttons.editDisabled = "No layers to edit.";
                                L.drawLocal.edit.toolbar.buttons.remove = "Delete layers";
                                L.drawLocal.edit.toolbar.buttons.removeDisabled = "No layers to delete.";
                                L.drawLocal.edit.handlers.edit.tooltip.text = "Drag handles, or marker to edit feature.";
                                L.drawLocal.edit.handlers.edit.tooltip.subtext = "Click cancel to undo changes.";
                                L.drawLocal.edit.handlers.remove.tooltip.text = "Click on a feature to remove";

                                L.Control.ResetView.TITLE = "Reset view";
                                L.Control.ResetView.ICON = "url(/static/leaflet/images/reset-view.png)";


                                function id_coordenada_map_callback(map, options) {

                                    //function getLocation() {
                                        if (navigator.geolocation) {
                                            navigator.geolocation.getCurrentPosition(success, showError);
                                        } else { 
                                            x.innerHTML = "Geolocation is not supported by this browser.";
                                        }
                                    //}
                                    
                                    //navigator.geolocation.getCurrentPosition(success);
									
									function success(pos) {
									    var crd = pos.coords;
									    lat=crd.latitude;
									    lon=crd.longitude;
									
									    // arbitrary js object:
									    var myJsObj = {'type':'Point', 'coordinates':[lon,lat]};

									    // using JSON.stringify pretty print capability:
									    var str = JSON.stringify(myJsObj, undefined, 4);

									    // display pretty printed object in text area:
									    document.getElementById('id_coordenada').innerHTML = str;
									
									    geodjango_id_coordenada.store_class = L.FieldStore;
                                        geodjango_id_coordenada.precision = options.djoptions.precision;
									
                                        (new L.GeometryField(geodjango_id_coordenada)).addTo(map);

                                    };
                                    
                                    function showError(error) {
                                        if(error){
                                            alert("Por favor, permita a localização no seu navegador.");
                                        }
                                        
									    lat=-23.561110158851235;
									    lon=-46.6564872026675;
									
									    // arbitrary js object:
									    var myJsObj = {'type':'Point', 'coordinates':[lon,lat]};

									    // using JSON.stringify pretty print capability:
									    var str = JSON.stringify(myJsObj, undefined, 4);

									    // display pretty printed object in text area:
									    document.getElementById('id_coordenada').innerHTML = str;
									
									    geodjango_id_coordenada.store_class = L.FieldStore;
                                        geodjango_id_coordenada.precision = options.djoptions.precision;
									
                                        (new L.GeometryField(geodjango_id_coordenada)).addTo(map);


                                    }
                            
                                };


                            </script>



                            <div id="id_coordenada-div-map">



                                <div id="id_coordenada-map" class="leaflet-container-default w-100"></div>
                                <script>
                                    (function () {

                                        function loadmap() {
                                            var djoptions = { "srid": null, "extent": [[-90, -180], [90, 180]], "fitextent": true, "center": null, "zoom": null, "precision": 6, "minzoom": null, "maxzoom": null, "layers": [["OSM", "//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", "\u00a9 <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors"]], "overlays": [], "attributionprefix": null, "scale": "metric", "minimap": false, "resetview": true, "tilesextent": [] },
                                                options = {
                                                    djoptions: djoptions, initfunc: loadmap,
                                                    globals: false, callback: id_coordenada_map_callback
                                                },
                                                map = L.Map.djangoMap('id_coordenada-map', options);

                                        }
                                        var loadevents = ["load"];
                                        if (loadevents.length === 0) loadmap();
                                        else if (window.addEventListener) for (var i = 0; i < loadevents.length; i++) window.addEventListener(loadevents[i], loadmap, false);
                                        else if (window.jQuery) jQuery(window).on(loadevents.join(' '), loadmap);

                                    })();
                                </script>


                            </div>


                            <!--<textarea id="idDoCampo" class="required django-leaflet-raw-textarea" cols="150" rows="10" name="coordenada">
                                { &quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ -46.655804144995663, -23.565801069428833 ] }
                            </textarea>-->  
                            <textarea required="required" id="id_coordenada" class="required django-leaflet-raw-textarea" cols="150" rows="10" name="coordenada">
                                
                            </textarea>
                            



                            <!--<textarea id="id_coordenada" class="required django-leaflet-raw-textarea"
                                cols="150" rows="10"
                                name="coordenada">"{{ pet.coordenada }}"</textarea> -->
                                <!--&quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [ -46.648001, -23.575882 ]-->



                        </div>

                    </div>

                </fieldset>

                <script id="django-admin-form-add-constants" src="/static/admin/js/change_form.js"
                    async>
                    </script>

                <script id="django-admin-prepopulated-fields-constants"
                    src="/static/admin/js/prepopulate_init.js" data-prepopulated-fields="[]">
                    </script>
            
            
        
        
            </div>







            <button type="submit" class="btn btn-outline-dark mt-4 w-100">
                {% if pet %}
                    {% trans "Alterar" %}
                {% else %}
                    {% trans "Cadastrar" %}
                {% endif %}
            </button>
        </div>
        </div>
    </form>
 <!-- 
  <form method='POST'>{% csrf_token %}
    {{ form.as_p }}
    <input type='submit' value='Save' />
</form>
-->
<br><br>
{% endblock %}